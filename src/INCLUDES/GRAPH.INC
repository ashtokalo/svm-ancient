 ;---------------------------------------------------------------------------
 ;                                Graphics
 ;                               Version 1.0
 ;                      Copyright (C) 1999 ShAG Studio
 ;---------------------------------------------------------------------------
 ;    Этот  модуль  предназначен  для  работы  с  графическими  устройствами.
 ; Команды,  которые  вы  найдете  здесь  помогут вам с легкостью выводить на
 ; графические устройства все, что вы захотите.
 ;
 ; Список процедур доступных для вызова:
 ;    SelectGD       - Выбрать графическое устройство
 ;    MaxPos         - Возвращает максимальную координату по оси X и Y
 ;    SetColor       - Устанавливает цвет, которым все будет выводиться
 ;    PutPixel       - Выводит точку по заданным координатам
 ;    GetPixel       - Читает точку по заданным координатам
 ;    DrawLine       - Выводит линию
 ;    DrawRect       - Выводит незакрашеный прямоугольник
 ;    DrawOval       - Выводит незакрашеный овал
 ;    DrawPolygon    - Выводит незакрашеный многоугольник
 ;    FillRect       - Выводит закрашеный прямоугольник
 ;    FillOval       - Выводит закрашеный овал
 ;
 ;    GetFonts       - Возвращает количество шрифтов установленных в системе
 ;    GetFontName    - Возвращает имя шрифта по его номеру
 ;    SetFontStyle   - Устанавливает параметры шрифта
 ;    GetFontStyle   - Возвращает параметры шрифта
 ;    DrawString     - Выводит строку на графическое устройство
 ;    StringWidth    - Возвращает длинну строки в точках
 ;
 ;    RGBToInt       - Упаковывает интенсивности в одно целое число
 ;    IntToRGB       - Распаковывает целое число на интенсивности
 ;    TPointToInt    - Упаковывает координату X и Y в одно целое число
 ;    IntToTPoint    - Распаковывает целое число на координаты X и Y
 ;    ToPixels       - Переводит пункты в точки
 ;    ToItems        - Переводит точки в пункты
 ;
 ;    Чтобы использовать этот модуль вы должны вставить в свою программу
 ; следующюю строку: INCLUDE Graph.inc  или добавить через запятую, если
 ; директива INCLUDE уже где-то использовалась.
 ;---------------------------------------------------------------------------

 ; Переменные и константы
 PixelMode DB 0 ; Если эта переменная равна 1, то при выводе точки на экран
                ; стандартный цвет устанавливается равным цвету выводимой
                ; точки. Если эта переменная не равна 1, то точка выводится
                ; стандартным цветом, который при этом не изменяется.

 PackInt DQ 0   ; Переменная используется при кодировке цветов и координат
 GError  DB 1   ; В этой переменной будут помещаться коды ошибок

 ; Ошибки, которые могут возникнуть в процессе работы и их код определены
 ; как константы и описанны ниже:
 NoError EQU 0      ; Ошибки отсутствуют
 GNoPiks EQU 1      ; Количество вершин многоугольника должно быть > 1
 GFontAbsent EQU 15 ; Шрифт с таким номером не существует

 ; Список, доступных для выбора, графических устройств:
 GDScreen EQU 0     ; Графическое устройство типа экран

 ; Заранее определенные константы и переменные, для облегчения работы с
 ; этим модулем:

 ; Цвета:          Интенсивности:      Русские названия
 ;                  R    G    B
   Black        DB 0,   0,   0,   0  ; черный
   DackBlue     DB 0,   0,   128, 0  ; темно-синий
   DackGreen    DB 0,   128, 0,   0  ; темно-зеленый
   DackRed      DB 128, 0,   0,   0  ; темно-красный
   DackCyan     DB 0,   128, 128, 0  ; темный циан
   DackMagenta  DB 128, 0,   128, 0  ; темный фуксин
   DackYellow   DB 128, 128, 0,   0  ; темно-желтый
   DackGray     DB 128, 128, 128, 0  ; темно-серый
   White        DB 255, 255, 255, 0  ; белый
   Blue         DB 0,   0,   255, 0  ; синий
   Green        DB 0,   255, 0,   0  ; зеленый
   Red          DB 255, 0,   0,   0  ; красный
   Cyan         DB 0,   255, 255, 0  ; циан
   Magenta      DB 255, 0,   255, 0  ; фуксин
   Yellow       DB 255, 255, 0,   0  ; желтый
   Gray         DB 192, 192, 192, 0  ; серый

 ; Шрифты:
   Bold             DB 1    ; жирный
   Italic           DB 2    ; курсив
   UnderLine        DB 4    ; подчеркнутый
   StrikeLine       DB 8    ; зачеркнутый
   BoldItalic       DB 3    ; жирный курсив
   BoldUnderLine    DB 5    ; жирный подчеркнутый
   BoldStrikeLine   DB 9    ; жирный зачеркнутый
   ItalicUnderLine  DB 6    ; подчеркнутый курсив
   ItalicStrikeLine DB 10   ; зачеркнутый курсив
   UnderStrikeLine  DB 12   ; подчеркнуто-зачеркнутый
 ; Другие комбинации можете подобрать сами

 ;---------------------------------------------------------------------------
 ; SelecetGD - Выбрать графическое устройство
 ;---------------------------------------------------------------------------
 ; Вход:
 ;  LBX - номер графического устройства
 ;        невыбрав графическое устройство, вы не сможете воспользоваться
 ;        этим модулем
 ; Выход:
 ;  нет
 ; Регистры:
 ;  LBX
 ;---------------------------------------------------------------------------
 PROC SelectGD
  PUSH LAX
  MOV  LAX, 0
  CSP  4
  MOV  BYTE [GError], AL
  POP  LAX
  RET

 ;---------------------------------------------------------------------------
 ; MaxPos - Возвращает максимальную координату по оси X и Y
 ;---------------------------------------------------------------------------
 ; Вход:
 ;  нет
 ; Выход:
 ;  EBX - максимальная координата по оси X
 ;  ECX - максимальная координата по оси Y
 ; Регистры:
 ;  EBX, ECX
 ;---------------------------------------------------------------------------
 PROC MaxPos
  PUSH LAX
  MOV  LAX, 1
  CSP  4
  MOV  BYTE [GError], AL
  POP  LAX
  RET

 ;---------------------------------------------------------------------------
 ; SetColor - Устанавливает цвет, которым все будет выводиться
 ;---------------------------------------------------------------------------
 ; Вход:
 ;  EDX - цвет (три интенсивности R,G,B)
 ; Выход:
 ;  нет
 ; Регистры:
 ;  EDX
 ;---------------------------------------------------------------------------
 PROC SetColor
  PUSH LAX
  MOV  LAX, 5
  CSP  4
  MOV  BYTE [GError], AL
  POP  LAX
  RET

 ;---------------------------------------------------------------------------
 ; PutPixel - Выводит точку по заданным координатам
 ;---------------------------------------------------------------------------
 ; Вход:
 ;  EBX - координата по оси X
 ;  ECX - координата по оси Y
 ;  Если переменная PixelMode равна 1, то в регистре EDX должен находиться
 ;  цвет выводимой точки, иначе точка выводится стандартным цветом, если
 ;  регистр переменная PixelMode равна 1, то стандартный цвет равен EDX.
 ; Выход:
 ;  нет
 ; Регистры:
 ;  EBX, ECX
 ;---------------------------------------------------------------------------
 PROC PutPixel
  PUSH LAX
  CMP  BYTE [PixelMode], 1
  JNE  @No_Color
  CALL SetColor
 @No_Color:
  MOV  LAX, 3
  CSP  4
  MOV  BYTE [GError], AL
  POP  LAX
  RET

 ;---------------------------------------------------------------------------
 ; GetPixel - Читает точку по заданным координатам
 ;---------------------------------------------------------------------------
 ; Вход:
 ;  EBX - координата по оси X
 ;  ECX - координата по оси Y
 ; Выход:
 ;  EDX - цвет точки по этим координатам
 ; Регистры:
 ;  EBX, ECX, EDX
 ;---------------------------------------------------------------------------
 PROC GetPixel
  PUSH LAX
  MOV  LAX, 4
  CSP  4
  MOV  BYTE [GError], AL
  POP  LAX
  RET

 ;---------------------------------------------------------------------------
 ; DrawLine - Выводит линию
 ;---------------------------------------------------------------------------
 ; Вход:
 ;  LBX - координаты по оси X и Y первой точки
 ;  LCX - координаты по оси X и Y второй точки
 ; Выход:
 ;  нет
 ; Регистры:
 ;  LBX, LCX
 ;---------------------------------------------------------------------------
 PROC DrawLine
  PUSH LAX
  MOV  LAX, 8
  CSP  4
  MOV  BYTE [GError], AL
  POP  LAX
  RET

 ;---------------------------------------------------------------------------
 ; DrawRect - Выводит не закрашеный прямоугольник
 ;---------------------------------------------------------------------------
 ; Вход:
 ;  LBX - координаты по оси X и Y одного угла (верхний левый угол)
 ;  LCX - координаты по оси X и Y другого угла (нижний правый угол)
 ; Выход:
 ;  нет
 ; Регистры:
 ;  LBX, LCX
 ;---------------------------------------------------------------------------
 PROC DrawRect
  PUSH LAX
  MOV  LAX, 9
  CSP  4
  MOV  BYTE [GError], AL
  POP  LAX
  RET

 ;---------------------------------------------------------------------------
 ; DrawOval - Выводит незакрашеный овал
 ;---------------------------------------------------------------------------
 ; Вход:
 ;  LBX - координаты по оси X и Y одного угла (верхний левый угол)
 ;  LCX - координаты по оси X и Y другого угла (нижний правый угол)
 ;  Овал будет вписан в прямоугольник образованный этими координатами
 ; Выход:
 ;  нет
 ; Регистры:
 ;  LBX, LCX
 ;---------------------------------------------------------------------------
 PROC DrawOval
  PUSH LAX
  MOV  LAX, 10
  CSP  4
  MOV  BYTE [GError], AL
  POP  LAX
  RET

 ;---------------------------------------------------------------------------
 ; DrawPolygon - Выводит незакрашеный многоугольник
 ;---------------------------------------------------------------------------
 ; Вход:
 ;  LEP - адрес области координат
 ;  Область координат содержит следующие данные:
 ;   первые четыри байта - количество узлов в многоугольнике = n
 ;   затем следует n пар четырехбайтных чисел, где каждая пара содержит
 ;   два 4-х байтных числа - X и Y координату
 ; Выход:
 ;  нет
 ; Регистры:
 ;  LEP
 ;---------------------------------------------------------------------------
 PROC DrawPolygon
  PUSH LAX
  MOV  LAX, 11
  CSP  4
  MOV  BYTE [GError], AL
  POP  LAX
  RET

 ;---------------------------------------------------------------------------
 ; FillRect - Выводит закрашеный прямоугольник
 ;---------------------------------------------------------------------------
 ; Вход:
 ;  LBX - координаты по оси X и Y одного угла (верхний левый угол)
 ;  LCX - координаты по оси X и Y другого угла (нижний правый угол)
 ; Выход:
 ;  нет
 ; Регистры:
 ;  LBX, LCX
 ;---------------------------------------------------------------------------
 PROC FillRect
  PUSH LAX
  MOV  LAX, 13
  CSP  4
  MOV  BYTE [GError], AL
  POP  LAX
  RET

 ;---------------------------------------------------------------------------
 ; FillOval - Выводит закрашеный овал
 ;---------------------------------------------------------------------------
 ; Вход:
 ;  LBX - координаты по оси X и Y одного угла (верхний левый угол)
 ;  LCX - координаты по оси X и Y другого угла (нижний правый угол)
 ;  Овал будет вписан в прямоугольник образованный этими координатами
 ; Выход:
 ;  нет
 ; Регистры:
 ;  LBX, LCX
 ;---------------------------------------------------------------------------
 PROC FillOval
  PUSH LAX
  MOV  LAX, 14
  CSP  4
  MOV  BYTE [GError], AL
  POP  LAX
  RET


 ;---------------------------------------------------------------------------
 ; GetFonts - Возвращает количество шрифтов установленных в системе
 ;---------------------------------------------------------------------------
 ; Вход:
 ;  нет
 ; Выход:
 ;  LDX - количество установленных в системе шрифтов
 ; Регистры:
 ;  LDX
 ;---------------------------------------------------------------------------
 PROC GetFonts
  PUSH LAX
  MOV  LAX, 20
  CSP  4
  MOV  BYTE [GError], AL
  POP  LAX
  RET

 ;---------------------------------------------------------------------------
 ; GetFontName - Возвращает имя шрифта по его номеру
 ;---------------------------------------------------------------------------
 ; Вход:
 ;  EDX - номер шрифта, имя которого вы хотите получить
 ;  LEP - адрес строки, в которую надо записать имя шрифта. Имя шрифта
 ;  может колебаться в пределах от 1 до 255 символов.
 ; Выход:
 ;  по адресу в LEP заносится имя шрифта
 ; Регистры:
 ;  EDX, LEP
 ;---------------------------------------------------------------------------
 PROC GetFontName
  PUSH LAX
  MOV  LAX, 21
  CSP  4
  MOV  BYTE [GError], AL
  POP  LAX
  RET

 ;---------------------------------------------------------------------------
 ; SetFontStyle - Устанавливает параметры шрифта
 ;---------------------------------------------------------------------------
 ; Вход:
 ;  EDX - номер шрифта, для которого вы хотите изменить параметры
 ;  EBX - размер в пунктах. 1 пункт - 1/72 дюйма.
 ;  CL  - вид шрифта:
 ;         0 - обычный
 ;         1 - жирный
 ;         2 - курсив
 ;         4 - подчеркнутый
 ;         8 - зачеркнутый
 ;  Можно сумировать параметры, тогда выводимый текст будет иметь все
 ;  установленные вами параметры.
 ; Выход:
 ;  нет
 ; Регистры:
 ;  EBX, EDX, CL
 ;---------------------------------------------------------------------------
 PROC SetFontStyle
  PUSH LAX
  MOV  LAX, 22
  CSP  4
  MOV  BYTE [GError], AL
  POP  LAX
  RET

 ;---------------------------------------------------------------------------
 ; GetFontStyle - Возвращает параметры шрифта
 ;---------------------------------------------------------------------------
 ; Вход:
 ;  EDX - номер шрифта, параметры которого вы хотите получить
 ; Выход:
 ;  EBX - размер в пунктах. 1 пункт - 1/72 дюйма.
 ;  CL  - вид шрифта:
 ;         0 - обычный
 ;         1 - жирный
 ;         2 - курсив
 ;         4 - подчеркнутый
 ;         8 - зачеркнутый
 ;  Параметры могут быть сумированными
 ; Регистры:
 ;  EBX, EDX, CL
 ;---------------------------------------------------------------------------
 PROC GetFontStyle
  PUSH LAX
  MOV  LAX, 23
  CSP  4
  MOV  BYTE [GError], AL
  POP  LAX
  RET

 ;---------------------------------------------------------------------------
 ; DrawString - Выводит строку на графическое устройство
 ;---------------------------------------------------------------------------
 ; Вход:
 ;  EDX - номер шрифта, которым вы хотите вывести текст.
 ;  LEP - адрес строки. Строка должна заканчиваться 0.
 ;  EBX - координата X для базовой линии
 ;  ECX - координата Y для базовой линии
 ; Выход:
 ;  На графическое устройство выводится текст заданным шрифтом и параметрами.
 ; Регистры:
 ;  EDX, EBX, ECX, LEP
 ;---------------------------------------------------------------------------
 PROC DrawString
  PUSH LAX
  MOV  LAX, 24
  CSP  4
  MOV  BYTE [GError], AL
  POP  LAX
  RET

 ;---------------------------------------------------------------------------
 ; StringWidth - Возвращает длинну строки в точках
 ;---------------------------------------------------------------------------
 ; Вход:
 ;  EDX - номер шрифта, которым вы хотите вывести текст.
 ;  LEP - адрес строки. Строка должна заканчиваться 0.
 ; Выход:
 ;  EBX - длинна строки в точках
 ; Регистры:
 ;  EBX, LEP, EDX
 ;---------------------------------------------------------------------------
 PROC StringWidth
  PUSH LAX
  MOV  LAX, 25
  CSP  4
  MOV  BYTE [GError], AL
  POP  LAX
  RET

 ;---------------------------------------------------------------------------
 ; RGBToInt - Упаковывает интенсивности в одно целое число
 ;---------------------------------------------------------------------------
 ; Вход:
 ;  AL - интенсивность красного
 ;  AH - интенсивность зеленого
 ;  BL - интенсивность синего
 ; Выход:
 ;  EDX - упакованные цвет - целое число
 ; Регистры:
 ;  AX, BL, EDX
 ;---------------------------------------------------------------------------
 PROC RGBToInt
  PUSH BH
  MOV  BYTE [PackInt], AL
  MOV  BH, 1
  MOV  BYTE [PackInt+BH], AH
  MOV  BH, 2
  MOV  BYTE [PackInt+BH], BL
  MOV  BH, 3
  MOV  BYTE [PackInt+BH], 0
  MOV  DWORD EDX, [PackInt]
  POP  BH
  RET

 ;---------------------------------------------------------------------------
 ; IntToRGB - Распаковывает целое число на интенсивности
 ;---------------------------------------------------------------------------
 ; Вход:
 ;  EDX - упакованные цвет - целое число
 ; Выход:
 ;  AL - интенсивность красного
 ;  AH - интенсивность зеленого
 ;  BL - интенсивность синего
 ; Регистры:
 ;  AX, BL, EDX
 ;---------------------------------------------------------------------------
 PROC IntToRGB
  PUSH BH
  MOV  DWORD [PackInt], EDX
  MOV  BYTE AL, [PackInt]
  MOV  BH, 1
  MOV  BYTE AH, [PackInt+BH]
  MOV  BH, 2
  MOV  BYTE BL, [PackInt+BH]
  POP  BH
  RET

 ;---------------------------------------------------------------------------
 ; TPointToInt - Упаковывает координату X и Y в одно целое число
 ;---------------------------------------------------------------------------
 ; Вход:
 ;  EBX - Координата X
 ;  ECX - Координата Y
 ; Выход:
 ;  LDX - Упакованные координаты
 ; Регистры:
 ;  EBX, ECX, LDX
 ;---------------------------------------------------------------------------
 PROC TPointToInt
  PUSH AH
  MOV  DWORD [PackInt], EBX
  MOB  AH, 4
  MOV  DWORD [PackInt+AH], ECX
  POP  AH
  MOV  QWORD LDX, [PackInt]
  RET

 ;---------------------------------------------------------------------------
 ; IntToTPoint - Распаковывает целое число на координаты X и Y
 ;---------------------------------------------------------------------------
 ; Вход:
 ;  LDX  - Упакованные координаты
 ; Выход:
 ;  EBX - Координата X
 ;  ECX - Координата Y
 ; Регистры:
 ;  EBX, ECX, LDX
 ;---------------------------------------------------------------------------
 PROC IntToTPoint
  PUSH AH
  MOV  QWORD [PackInt], LDX
  MOV  DWORD EBX, [PackInt]
  MOV  AH, 4
  MOV  DWORD ECX, [PackInt+AH]
  POP  AH
  RET

 ;---------------------------------------------------------------------------
 ; ToPixels - Переводит пункты в точки
 ;---------------------------------------------------------------------------
 ; Вход:
 ;  EBX - количество пунктов
 ; Выход:
 ;  EBX - количество пикселей
 ; Регистры:
 ;  EBX
 ;---------------------------------------------------------------------------
 PROC ToPixels
  PUSH LAX
  MOV  LAX, 27
  CSP  4
  MOV  BYTE [GError], AL
  POP  LAX
  RET

 ;---------------------------------------------------------------------------
 ; ToItems - Переводит пункты в точки
 ;---------------------------------------------------------------------------
 ; Вход:
 ;  EBX - количество пикселей
 ; Выход:
 ;  EBX - количество пунктов
 ; Регистры:
 ;  EBX
 ;---------------------------------------------------------------------------
 PROC ToItems
  PUSH LAX
  MOV  LAX, 26
  CSP  4
  MOV  BYTE [GError], AL
  POP  LAX
  RET

 ;---------------------------------------------------------------------------
 ;                                 Stream
 ;                               Version 1.0
 ;                      Copyright (C) 1999 ShAG Studio
 ;---------------------------------------------------------------------------
 ;    Этот  модуль  содержит команды для работы с потоками, которые являются
 ; основными поставщиками  информации от внешних устройств. Поток может быть
 ; открытым  и закрытым, при этом, если  его закрыть, то дальнейшая работа с
 ; этим потоком будет  невозможна. Каждый поток имеет свой номер по которому
 ; вы будете к  нему обращаться, поэтому после уничтожения потока, его номер
 ; становится недействительным.
 ;
 ; Список процедур доступных для вызова:
 ;  ReadByte    - Прочитать байт из потока
 ;  ReadArray   - Прочитать несколько байт из потока в массив
 ;  ReadAndStay - Прочитать байт из потока, не извлекая его от туда
 ;  WriteByte   - Записать байт в поток
 ;  WriteArray  - Записать несколько байт в поток из массива
 ;  Skeep       - Пропустить несколько байт в потоке
 ;  GetTotal    - Получить количество непрочитанных байт в потоке
 ;  Mark        - Запомнить место в потоке
 ;  BackToMark  - Вернуться к запомненому месту в потоке
 ;  StreamType  - Получить тип потока
 ;  CloseStream - Закрыть поток
 ;
 ;    Чтобы использовать этот модуль вы должны вставить в свою программу
 ; следующюю строку: INCLUDE Stream.inc  или добавить через запятую, если
 ; директива INCLUDE уже где-то использовалась.
 ;---------------------------------------------------------------------------

 ;---------------------------------------------------------------------------
 ; ReadByte    - Прочитать байт из потока
 ;---------------------------------------------------------------------------
 ; Вход:
 ;  EDX - Номер потока
 ; Выход:
 ;  BL  - байт прочитаный из потока
 ; Регистры:
 ;  EDX, BL
 ;---------------------------------------------------------------------------
 PROC ReadByte
  PUSH LAX
  MOV  LAX, 20
  CSP  2
  POP  LAX
  RET

 ;---------------------------------------------------------------------------
 ; ReadArray   - Прочитать несколько байт из потока в массив
 ;---------------------------------------------------------------------------
 ; Вход:
 ;  LCX - Количество байт которые надо прочитать
 ;  EDX - Номер потока
 ;  LEP - Адрес в памяти, куда надо читать байты
 ; Выход:
 ;  LCX - Количество байт, которые удалось прочитать из потока
 ; Регистры:
 ;  LCX, EDX, LEP
 ;---------------------------------------------------------------------------
 PROC ReadArray
  PUSH LAX
  MOV  LAX, 21
  CSP  2
  POP  LAX
  RET

 ;---------------------------------------------------------------------------
 ; ReadAndStay - Прочитать байт из потока, не извлекая его от туда
 ;---------------------------------------------------------------------------
 ; Вход:
 ;  EDX - Номер потока
 ; Выход:
 ;  BL  - байт прочитаный из потока, но оставшийся там
 ; Регистры:
 ;  EDX, BL
 ;---------------------------------------------------------------------------
 PROC ReadAndStay
  PUSH LAX
  MOV  LAX, 22
  CSP  2
  POP  LAX
  RET

 ;---------------------------------------------------------------------------
 ; WriteByte   - Записать байт в поток
 ;---------------------------------------------------------------------------
 ; Вход:
 ;  EDX - Номер потока
 ;  BL  - байт, который надо записать в поток
 ; Выход:
 ;  нет
 ; Регистры:
 ;  EDX, BL
 ;---------------------------------------------------------------------------
 PROC WriteByte
  PUSH LAX
  MOV  LAX, 23
  CSP  2
  POP  LAX
  RET

 ;---------------------------------------------------------------------------
 ; WriteArray  - Записать несколько байт в поток из массива
 ;---------------------------------------------------------------------------
 ; Вход:
 ;  LCX - Количество байт которые надо записать
 ;  EDX - Номер потока
 ;  LEP - Адрес в памяти, откуда надо брать записываемые байты
 ; Выход:
 ;  LCX - Количество байт, которые удалось записать в поток
 ; Регистры:
 ;  LCX, EDX, LEP
 ;---------------------------------------------------------------------------
 PROC WriteArray
  PUSH LAX
  MOV  LAX, 24
  CSP  2
  POP  LAX
  RET

 ;---------------------------------------------------------------------------
 ; Skeep       - Пропустить несколько байт в потоке
 ;---------------------------------------------------------------------------
 ; Вход:
 ;  LCX - Количество байт, которое надо пропустить в потоке
 ;  EDX - Номер потока
 ; Выход:
 ;  LCX - Количество байт, которое удалось пропустить в потоке
 ; Регистры:
 ;  LCX, EDX
 ;---------------------------------------------------------------------------
 PROC Skeep
  PUSH LAX
  MOV  LAX, 25
  CSP  2
  POP  LAX
  RET

 ;---------------------------------------------------------------------------
 ; GetTotal    - Получить количество непрочитанных байт в потоке
 ;---------------------------------------------------------------------------
 ; Вход:
 ;  EDX - Номер потока
 ; Выход:
 ;  LCX - Количество непрочитанных байт в потоке
 ; Регистры:
 ;  LCX, EDX
 ;---------------------------------------------------------------------------
 PROC GetTotal
  PUSH LAX
  MOV  LAX, 26
  CSP  2
  POP  LAX
  RET

 ;---------------------------------------------------------------------------
 ; Mark        - Запомнить место в потоке
 ;---------------------------------------------------------------------------
 ; Вход:
 ;  EDX - Номер потока
 ; Выход:
 ;  нет
 ; Регистры:
 ;  EDX
 ;---------------------------------------------------------------------------
 PROC Mark
  PUSH LAX
  MOV  LAX, 27
  CSP  2
  POP  LAX
  RET

 ;---------------------------------------------------------------------------
 ; BackToMark  - Вернуться к запомненому месту в потоке
 ;---------------------------------------------------------------------------
 ; Вход:
 ;  EDX - Номер потока
 ; Выход:
 ;  нет
 ; Регистры:
 ;  EDX
 ;---------------------------------------------------------------------------
 PROC BackToMark
  PUSH LAX
  MOV  LAX, 28
  CSP  2
  POP  LAX
  RET

 ;---------------------------------------------------------------------------
 ; StreamType  - Получить тип потока
 ;---------------------------------------------------------------------------
 ; Вход:
 ;  EDX - Номер потока
 ; Выход:
 ;  BL  - Тип потока:
 ;        0 - поток не создан
 ;        1 - для чтения
 ;        2 - для записи
 ;        3 - для чтения и записи
 ; Регистры:
 ;  EDX, BL
 ;---------------------------------------------------------------------------
 PROC StreamType
  PUSH LAX
  MOV  LAX, 29
  CSP  2
  POP  LAX
  RET

 ;---------------------------------------------------------------------------
 ; CloseStream - Закрыть поток
 ;---------------------------------------------------------------------------
 ; Вход:
 ;  EDX - Номер потока, который надо закрыть
 ; Выход:
 ;  нет
 ; Регистры:
 ;  EDX
 ;---------------------------------------------------------------------------
 PROC CloseStream
  PUSH LAX
  MOV  LAX, 30
  CSP  2
  POP  LAX
  RET

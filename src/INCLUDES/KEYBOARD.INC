 ;---------------------------------------------------------------------------
 ;                                Keyboard
 ;                               Version 1.0
 ;                      Copyright (C) 1999 ShAG Studio
 ;---------------------------------------------------------------------------
 ;    Этот  модуль  содержит  две  процедуры, с  помощью  которых  вы сможете
 ; без проблем работать с клавиатурой.
 ;
 ; Список процедур доступных для вызова:
 ;    CreatKbdStream - создает поток клавиатуры
 ;    ReadKey        - возвращает код нажатого символа
 ;    KeyPressed     - возвращает состояние клавиатуры
 ;
 ;    Чтобы  использовать этот  модуль вы должны  вставить в свою программу
 ; следующюю строку: INCLUDE Keyboard.inc  или добавить через запятую, если
 ; директива INCLUDE уже где-то использовалась.
 ;---------------------------------------------------------------------------
  INCLUDE   Stream.inc ; подключаем модуль для работы с потоками

  KbdStream DD 0  ; номер потока клавиатуры

 ;---------------------------------------------------------------------------
 ; CreatKbdStream - создает поток клавиатуры
 ;---------------------------------------------------------------------------
 ; Вход:
 ;  нет
 ; Выход:
 ;  EDX - номер потока клавиатуры
 ; Регистры:
 ;  EDX
 ;---------------------------------------------------------------------------
 PROC CreatKbdStream
  PUSH LAX
  MOV  LAX, 0
  CSP  3
  MOV  DWORD [KbdStream], EDX
  POP  LAX
  RET

 ;---------------------------------------------------------------------------
 ; ReadKey - прочитать один символ из потока клавиатуры
 ;---------------------------------------------------------------------------
 ; Вход:
 ;  нет
 ; Выход:
 ;  BL - ASCII код символа
 ; Регистры:
 ;  BL
 ;---------------------------------------------------------------------------
 PROC ReadKey
  PUSH LAX
  PUSH EDX
  MOV  DWORD EDX, [KbdStream]
  CALL ReadByte
  POP  EDX
  POP  LAX
  RET

 ;---------------------------------------------------------------------------
 ; KeyPressed - проверка нажатия кнопки на клавиатуре
 ;---------------------------------------------------------------------------
 ; Вход:
 ;  нет
 ; Выход:
 ;  zf - 1 если нажата кнопка, 0 - если нет
 ; Регистры:
 ;  нет
 ;---------------------------------------------------------------------------
 PROC KeyPressed
  PUSH LAX
  PUSH EDX
  MOV  DWORD EDX, [KbdStream]
  CALL GetTotal
  CLZ
  CMP  LCX, 0
  JE   @No_Pressed
  STZ
  @No_Pressed:
  POP  EDX
  POP  LAX
  RET